# План улучшений агрегатора (2025-12-23)

## Цели

- Повысить качество контента за счет улучшенной фильтрации и ML.
- Ускорить сбор и обработку данных для регулярных дайджестов.
- Обеспечить наблюдаемость, надежность и безопасность работы.

## Быстрые победы (1–2 недели)

- Асинхронный сбор данных (asyncio + asyncpraw + aiohttp) для Reddit/HN/YouTube.
- Дедупликация постов по похожести заголовков/описаний (fuzzy matching, MinHash).
- Расширение фильтров: обнаружение языка, стоп-слова, расширенные стоп-топики.
- Улучшенный HTML-отчет: поиск/фильтры, сортировка, тёмная тема, экспорт JSON/MD/RSS.
- Логирование в JSON + базовые метрики (время сбора, кол-во постов, отказы API).

## Архитектура и производительность

- Вынести конфигурацию в Pydantic Settings с чтением из .env и переменных окружения.
- Кэширование результатов запросов (Redis/файловый кэш) и backoff/retry для API.
- БД для хранения сырья и результатов (SQLite локально, PostgreSQL в проде).
- Batch-процессинг в ML и подсчете скорингов для ускорения.

## ML и качество фильтрации

- Перейти на трансформеры (DistilBERT/BERT) с дообучением на целевой выборке.
- Поддержка многоязычности (рус/eng), нормализация текста без потери кириллицы.
- Добавить онлайновый feedback loop (разметка пользователями → дообучение).
- Feature engineering: время публикации, автор, engagement rate, источники.

## Функциональность

- Тематические тренды во времени и sentiment analysis для тональности.

## Безопасность и конфигурация

- ✅ Secrets управляются через переменные окружения/secret manager (AGG_SECRETS_PATH),
  `.env` в репозитории больше не нужен.
- ✅ Rate limiting расширен (AsyncRateLimiter с профилями + URL validator для
  коллекций/отчётов); HTML/markdown поля экранируются автоматически.
- Политики ретраев и таймаутов для внешних API.

## Метрики успеха

- Точность/полнота фильтрации (precision/recall), средний combined_score топ-постов.
- Время полного цикла сбора → отчета; % ошибок API и ретраев.
- CTR/открытия уведомлений; доля положительного пользовательского feedback.
